libCURL.jl
==========

Thin Julia wrapper for libCURL

gen/generate.jl is used to generate the following files:


lC_common_h.jl : enum consts (generated by clang.jl)

lC_curl_h.jl : function wrappers using the @c macro (generated by clang.jl)

lC_defines_h.jl : '#define' s (generated using the standard C preprocessor and regex)

lC_exports_j.jl : exports (generated by parsing lC_common_h.jl and lC_curl_h.jl)

lC_defines_h.jl and lC_exports_j.jl will also be generated from clang.jl once clang.jl supports the same.

libCURL.jl mostly includes the generated files and also defines a few variadic functions (clang.jl does not yet support varargs)

libCURL.jl should be used for low level 1:1 mapping of the libCURL API in Julia.

HTTPC.jl is the http client API wrapping libCURL for common use cases

Mime_ext.jl is generated from /etc/mime.types and maps common file extensions to their MIME types


USAGE
=====

The exported APIs from module HTTPC are :

```
 get(url::String; nb::Bool, qd::Dict, rto::Float64, cb::Function)

 post (url::String, data; nb::Bool, qd::Dict, ct::String, rto::Float64, cb::Function)

 put (url::String, data; nb::Bool, qd::Dict, ct::String, rto::Float64, cb::Function)
``` 

- For both ```post``` and ```put``` above, the data can be either a
  - String - sent as is.
  - IOStream - Content type is set to "application/octet-stream" unless specified otherwise
  - Dict - Content type is set to "application/x-www-form-urlencoded" unless specified otherwise
  - (:file, filename::Filename) - The file is read, and the content-type is set automatically unless specified otherwise.

```
 head(url::String; nb::Bool, qd::Dict, rto::Float64, cb::Function)
 
 delete(url::String; nb::Bool, qd::Dict, rto::Float64, cb::Function)
 
 trace(url::String; nb::Bool, qd::Dict, rto::Float64, cb::Function)
 
 options(url::String; nb::Bool, qd::Dict, rto::Float64, cb::Function)
```

- Each method returns a Response object of the type:
```
    type Response
        body::String
        headers::Dict{ASCIIString, ASCIIString}
        http_code::Int
        total_time::Float64
    end
```

- ```nb```(Non-Blocking), ```qd```(Query String Dictionary), ```ct``` (ContentType), 
  ```rto```(Request TimeOut) and ```cb```(Callback Function) are all optional parameters.


- By default all APIs block till request completion and return Response objects. 

- If ```nb``` is set to ```true```, then the API returns immediately with a RemoteRef.

- The user can pass in a complete url in the ```url``` parameter or can pass in the query parameters
  in the ```qd```. 

  In the former case, the passed url is executed as is.

  In the latter case the complete URL if formed by concatenating the ```url``` field, a "?" and
  the escaped (key,value) pairs. Both the keys and values in the dictionary must be convertible to appropriate ASCIIStrings.
  Nested dictionaries and arrays are not supported.

- In all file upload cases, an attempt is made to set the ```ct``` type automatically as
  derived from the file extension
  
- Default value for the rto is 30.0 seconds

- Each of the functions takes in an optional callback. The signature of the callback should be
  ```customize_cb(curl)``` where ```curl``` is the libCURL handle. The callback can further customize
  the request by using libCURL easy* APIs directly


  
- The "_nb" versions of the above APIs are equivalent to calling each API with ```nb=true```
```
    get_nb, post_nb, put_nb, post_file_nb,
    put_file_nb, head_nb, delete_nb, trace_nb and options_nb
```


  
  
SAMPLES
=======
- See test/tests.jl for sample code

  
TODO
====
- Change the sleep in a loop to using fdwatcher when support for fdwatcher becomes available in mainline





